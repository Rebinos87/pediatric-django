{% extends 'base.html' %}

{% block title %}Patient: {{ patient.patient_name }}{% endblock %}

{% block content %}
<div class="patient-actions">
  <a href="{% url 'measurement_create' patient.pk %}" class="btn action-btn primary">+ Measurement</a>
  <a href="{% url 'patient_edit' patient.pk %}" class="btn action-btn btn-warning">Edit</a>
  <a href="{% url 'patient_documents' patient.pk %}" class="btn action-btn info">ðŸ“„ Documents</a>
  <a href="{% url 'patient_prescriptions' patient.pk %}" class="btn action-btn success">ðŸ’Š Prescriptions</a>
  <button type="button"
          class="btn action-btn danger"
          data-bs-toggle="modal"
          data-bs-target="#deletePatientModal">
    Delete
  </button>
</div>



<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deletePatientModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Patient?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete <strong>{{ patient.patient_name }}</strong>? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form method="post" action="{% url 'patient_delete' patient.pk %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete Permanently</button>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="row g-3 mb-3">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted mb-3">Demographics</h6>
        <p class="mb-1"><strong>DOB:</strong> {{ patient.date_of_birth|date:"Y-m-d" }}</p>
        <p class="mb-1"><strong>Age:</strong> {{ patient.get_age_display }}</p>
        <p class="mb-1"><strong>Gender:</strong> {{ patient.gender }}</p>
        <p class="mb-1"><strong>Blood Type:</strong> {{ patient.blood_type|default:"-" }}</p>
        <p class="mb-1"><strong>Contact:</strong> {{ patient.contact_number|default:"-" }}</p>
        <p class="mb-1"><strong>Parent:</strong> {{ patient.parent_name|default:"-" }}</p>
        <p class="mb-1"><strong>Parent Contact:</strong> {{ patient.parent_contact|default:"-" }}</p>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted mb-3">Latest Measurements</h6>
        <p class="mb-1"><strong>Height:</strong> {{ patient.latest_height|default:"-" }} cm</p>
        <p class="mb-1"><strong>Weight:</strong> {{ patient.latest_weight|default:"-" }} kg</p>
        <div class="mt-3">
          <a href="{% url 'growth_chart' patient.pk %}" class="btn btn-outline-primary btn-sm">
            View Growth Charts
          </a>
          <a href="{% url 'patient_report' patient.pk %}" class="btn btn-outline-secondary btn-sm">
            View Report
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h6 class="mb-0">Measurement History</h6>
  </div>
  <div class="card-body p-0">
        <table class="table table-hover mb-0">
        <thead class="table-light">
            <tr>
            <th>Date</th>
            <th>Age</th>
            <th>Height (cm)</th>
            <th>Weight (kg)</th>
            <th>BMI</th>
            <th>Actions</th>
            </tr>
        </thead>


      <tbody>
        {% for m in measurements %}
<tr>
  <td>{{ m.measurement_date|date:"Y-m-d" }}</td>
  <td>{{ m.age_display }}</td>
  <td>{{ m.height }}</td>
  <td>{{ m.weight }}</td>
  <td>
    {% if m.bmi %}
      {{ m.bmi|floatformat:1 }}
    {% else %}
      -
    {% endif %}
  </td>
  <td>
    <a href="{% url 'measurement_edit' patient.pk m.pk %}" class="btn btn-sm btn-warning">Edit</a>
    <a href="{% url 'measurement_delete' patient.pk m.pk %}" class="btn btn-sm btn-danger">Delete</a>
  </td>
</tr>

        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted py-3">No measurements recorded yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
